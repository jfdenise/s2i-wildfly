
source "${JBOSS_CONTAINER_UTIL_LOGGING_MODULE}/logging.sh"

# add support for copying cfg
function s2i_core_copy_artifacts_hook() {
  eap_s2i_copy_modules $*
  wildfly_s2i_copy_cfg $*
}

# copy cfg
function wildfly_s2i_copy_cfg() {
  if [ -d "${1}/cfg" ]; then
    if [ -z "${S2I_TARGET_CONFIGURATION_DIR}" ]; then
      log_warning "Unable to copy configuration files.  No target directory specified for S2I_TARGET_CONFIGURATION_DIR"
    else
      if [ ! -d "${S2I_TARGET_CONFIGURATION_DIR}" ]; then
        log_info "S2I_TARGET_CONFIGURATION_DIR does not exist, creating ${S2I_TARGET_CONFIGURATION_DIR}"
        mkdir -pm 775 "${S2I_TARGET_CONFIGURATION_DIR}"
      fi
      log_info "Copying configuration from $(realpath --relative-to ${S2I_SOURCE_DIR} ${1}/cfg) to ${S2I_TARGET_CONFIGURATION_DIR}..."
      rsync -rl --out-format='%n' "${1}/cfg"/ "${S2I_TARGET_CONFIGURATION_DIR}"
    fi
  fi 
}
